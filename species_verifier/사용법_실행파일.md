# Species Verifier GUI앱 사용방법

## 1. 개요

Species Verifier GUI는 입력된 학명(Scientific Name)의 유효성을 WoRMS (World Register of Marine Species) 데이터베이스를 통해 검증하고, 단일/다중 학명 검색 시에는 해당 종에 대한 추가 정보를 요약하여 제공하는 데스크톱 애플리케이션입니다. 직접 학명을 입력하거나, CSV 또는 Excel 파일에 포함된 학명 목록을 일괄 처리할 수 있습니다.

## 2. 사용 방법

애플리케이션 창은 크게 다음과 같은 영역으로 나뉩니다.

* **입력 영역:** 학명을 직접 입력하거나 파일을 선택하는 위젯들이 있습니다.
* **결과 영역:** 검증 결과가 표 형태로 표시됩니다.
* **상태 표시 영역:** 검증 진행 상황(프로그레스 바, 상태 메시지)과 결과 저장 버튼이 표시됩니다.
* **푸터 영역:** 저작권 정보가 표시됩니다.

### 2.1. 단일 또는 다중 학명 검색

1. **학명 입력:** 상단의 "단일/다중 학명 입력" 필드에 검증할 학명을 입력합니다. 여러 학명을 한 번에 검증하려면 쉼표(,)로 구분하여 입력합니다 (예: `Gadus morhua, Homo sapiens`).
2. **형식 주의:**
   * 학명은 "속명 종소명" (예: `Gadus morhua`)과 같이 **최소 두 단어** 이상이어야 합니다.
   * 한글, 숫자, 일부 특수문자는 포함될 수 없습니다.
   * 형식에 맞지 않는 이름이 포함되어 있으면 오류 메시지가 표시되고 검색이 진행되지 않습니다.
3. **검색 실행:** "검색" 버튼을 클릭하거나 Enter 키를 누릅니다.
4. **결과 확인:** 검색이 진행되는 동안 상태 표시 영역에 진행률(빙글빙글 도는 표시)이 나타납니다. 완료되면 결과 영역의 표에 다음과 같은 정보가 표시됩니다.
   * **입력 학명:** 사용자가 입력한 이름
   * **검증됨 (Verified):** WoRMS에서 유효한 학명('accepted')으로 확인되면 "Yes", 아니면 "No".
   * **WoRMS 상태:** WoRMS에서의 상태 ('accepted', 'unaccepted', 'aphiaID not found' 등).
   * **WoRMS ID:** WoRMS 데이터베이스의 고유 ID (AphiaID).
   * **종 정보 (Species Info):** 애플리케이션 내부 기능을 통해 요약된 해당 종의 정보. (유효한 학명이며 정보를 찾은 경우 자동으로 표시됨. 정보를 찾지 못하면 '-' 표시)
5. **결과 저장:** 필요한 경우 "결과 저장 (Excel)" 버튼을 클릭하여 현재 표에 보이는 결과를 Excel 파일로 저장할 수 있습니다.

### 2.2. 파일 검증 (CSV 또는 Excel)

1. **파일 선택:** "파일 선택 (.csv, .xlsx)" 버튼을 클릭하여 학명 목록이 포함된 파일을 선택합니다.
2. **입력 파일 형식:**
   * 파일은 **CSV** 또는 **Excel (.xls, .xlsx)** 형식이어야 합니다.
   * **첫 번째 열(A열)** 에 검증할 학명이 포함되어야 합니다.
   * 각 학명은 "속명 종소명" (예: `Gadus morhua`)과 같이 **최소 두 단어** 이상이어야 합니다. 단일 단어(예: `Gadus`)만 있거나 형식에 맞지 않는 이름은 "형식 오류"로 처리됩니다.
   * 파일의 첫 번째 행은 **헤더(제목) 행**이어도 괜찮습니다. (예: 'ScientificName') 헤더 행은 형식 검증 규칙에 따라 자동으로 걸러지거나 처리되지 않을 수 있습니다. 헤더 행이 없어도 정상적으로 작동합니다.
3. **처리 제한:** 한 번에 처리할 수 있는 학명은 **최대 3000개**입니다. 파일에 3000개를 초과하는 학명이 포함된 경우, 팝업 메시지로 알려주고 처음 3000개만 처리합니다.
4. **배치 처리:** 대용량 파일의 경우, **100개**씩 나누어 처리하여 서버 부하를 줄이고 안정성을 높입니다. 각 배치의 결과는 실시간으로 표시됩니다.
5. **검증 실행:** "파일 검증" 버튼을 클릭합니다. (파일이 선택되어야 버튼이 활성화됩니다.)
6. **결과 확인:** 검증이 진행되는 동안 상태 표시 영역에 진행률(%)이 표시됩니다. 완료되면 결과 영역의 표에 다음과 같은 정보가 표시됩니다.
   * **입력 학명:** 파일의 첫 번째 열에서 읽어 들인 이름.
   * **검증됨 (Verified):** WoRMS 상태가 'accepted'이면 "Yes", 아니면 "No".
   * **WoRMS 상태:** WoRMS에서의 상태. 형식 검증에 실패한 경우 "형식 오류"로 표시됩니다.
   * **WoRMS ID:** WoRMS 데이터베이스의 고유 ID. 형식 오류 또는 조회 실패 시 '-' 표시.
   * **종 정보 (Species Info):** 파일 검증 시에는 **항상 "-"** 로 표시됩니다. 이 기능은 파일 처리 모드에서는 작동하지 않습니다.
7. **결과 저장:** "결과 저장 (Excel)" 버튼을 클릭하여 결과를 Excel 파일로 저장합니다. 형식 오류로 처리된 항목도 결과 파일에 포함됩니다.

## 3. 참고 사항

* **인터넷 연결:** WoRMS API 호출 (및 단일 검색 시 종 정보 조회)을 위해 인터넷 연결이 필요합니다.
* **캐싱:** 한 번 검증된 학명 정보(WoRMS 결과)는 내부적으로 캐싱될 수 있습니다. 동일한 학명을 다시 검색하면 캐시된 정보를 우선 사용하여 더 빠르게 결과를 얻을 수 있습니다. (캐싱 기능은 `.env` 파일의 Supabase 설정이 올바를 때 최적으로 작동합니다.)
* **대용량 파일 처리:** 3000개까지의 학명을 처리할 수 있으며, **100개**씩 나누어 처리합니다. 서버 부하 방지를 위해 **각 요청 사이에 짧은 지연 시간**이 적용되어 처리 시간이 다소 소요될 수 있습니다. 각 배치의 결과는 실시간으로 표시됩니다.

## 4. 실행 방법

Species Verifier GUI앱을 실행하려면 아래 방법 중 하나를 사용하세요.

### 4.1. PowerShell(명령 프롬프트)에서 실행

1. **프로젝트 루트 폴더로 이동합니다.**  
   예시:  
   ```powershell
   Set-Location D:\Projects\verified_species
   ```
2. **아래 명령어로 실행합니다.**  
   ```powershell
   python -m species_verifier.gui.app
   ```
   - `python -m` 옵션을 사용해야 내부 모듈 경로 오류 없이 실행됩니다.

### 4.2. 실행 스크립트(run_gui.bat)로 실행 (추천)

1. 아래 내용을 메모장에 복사해 `run_gui.bat`로 저장하세요.
   ```bat
   @echo off
   cd /d %~dp0
   python -m species_verifier.gui.app
   pause
   ```
2. `run_gui.bat` 파일을 **프로젝트 루트 폴더**(`D:\Projects\verified_species`)에 넣으세요.
3. **run_gui.bat를 더블클릭**하면 GUI가 실행됩니다.

### 4.3. 실행 시 주의사항

- 항상 **프로젝트 루트 폴더**에서 실행해야 합니다.
- `python -m species_verifier.gui.app` 명령어 또는 `run_gui.bat`를 사용하세요.
- 잘못된 위치(예: `species_verifier\gui` 폴더)에서 `python app.py`로 실행하면  
  `ModuleNotFoundError: No module named 'species_verifier'` 오류가 발생합니다.

## 5. 더 쉽게 실행하는 방법: run_gui.bat (추천)

명령어를 외우지 않아도, 아래처럼 실행 스크립트(bat 파일)를 만들어두면 더블클릭만으로 GUI를 실행할 수 있습니다.

### 5.1. bat 파일 만들기

1. 메모장에 아래 내용을 복사해서 붙여넣으세요.
   ```bat
   @echo off
   cd /d %~dp0
   python -m species_verifier.gui.app
   pause
   ```
2. 파일명을 `run_gui.bat`로 저장하고, **프로젝트 루트 폴더**(`D:\Projects\verified_species`)에 넣으세요.
3. 이제 **run_gui.bat를 더블클릭**하면 GUI가 바로 실행됩니다.

### 5.2. 추가 팁
- bat 파일을 바탕화면에 바로가기로 만들어두면 더 편하게 실행할 수 있습니다.
- bat 파일을 사용하면 명령어를 외울 필요가 없습니다.

## 6. 파일 캐시 관리

- **파일 로드 후 동작:** 파일을 로드한 후 텍스트 입력란에 새로운 학명을 입력해도 여전히 파일에서 로드된 학명으로 검증이 실행됩니다.
- **캐시 삭제 시점:**
  - **검증 완료 후:** 해당 탭의 파일 캐시가 자동으로 삭제되어 이후 텍스트 입력만 사용됩니다.
  - **검증 취소 후:** 모든 탭의 파일 캐시가 삭제됩니다.
- **파일 재사용:** 파일로 다시 검증하려면 "파일 찾기" 버튼을 다시 눌러 파일을 로드해야 합니다.

## 7. 문의 및 개선 제안

- **연락처:** ecomarine@korea.kr
- **개선 사항이나 오류 발견 시 위 이메일로 연락해 주세요.**

---
